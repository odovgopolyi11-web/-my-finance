<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>üí∞ –ú—ñ–π —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏–π —à–ª—è—Ö</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<style>
* {box-sizing: border-box;}
body {
  background:#0e0e0e; 
  color:#eee; 
  font-family:system-ui, -apple-system, sans-serif; 
  max-width:700px; 
  margin:auto; 
  padding:20px;
}
h1 {text-align:center; margin-bottom:10px; font-size:28px;}
h3 {color:#4cff7a; margin-top:30px; font-size:18px;}
.section {margin:20px 0;}
.tile {
  display:flex; 
  flex-direction:column; 
  justify-content:center; 
  align-items:center; 
  width:150px; 
  height:110px; 
  margin:6px; 
  border-radius:12px; 
  padding:10px; 
  background:#181818; 
  cursor:pointer; 
  transition:0.3s all; 
  color:#fff; 
  font-weight:bold;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
.tile:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.4);
}
.tile.jump {animation: jump 0.5s ease forwards;}
@keyframes jump {
  0% {transform: translateY(0) scale(1);} 
  25% {transform: translateY(-15px) scale(1.05);} 
  50% {transform: translateY(0) scale(1);} 
  75% {transform: translateY(-8px) scale(1.02);} 
  100% {transform: translateY(0) scale(1);}
}
.tile input {
  width:90px; 
  background:#222; 
  color:#0f0; 
  border:1px solid #333; 
  border-radius:6px; 
  padding:8px; 
  margin-top:5px; 
  text-align:center;
  font-size:14px;
  font-weight:bold;
}
.tile-name {
  font-size:16px;
  margin-bottom:4px;
}
.tile-remain {
  font-size:12px;
  color:#ccc;
  margin-top:4px;
}
.tilesContainer {
  display:flex; 
  flex-wrap:wrap; 
  justify-content:center;
  margin-top:15px;
}
.progress {
  background:#222; 
  height:25px; 
  border-radius:12px; 
  overflow:hidden; 
  margin:15px 0; 
  position:relative;
  border:1px solid #333;
}
.bar {
  height:100%; 
  transition:width 0.5s ease; 
  position:absolute; 
  top:0; 
  left:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  font-weight:bold;
}
.red {background:#ff5c5c; z-index:1;}
.big {
  font-size:36px; 
  text-align:center; 
  margin:15px 0;
  font-weight:bold;
}
.negative {color:#ff5c5c;}
.positive {color:#4cff7a;}
.small {
  color:#888; 
  text-align:center;
  font-size:14px;
  margin-bottom:20px;
}
.addForm {
  display:flex;
  gap:8px;
  justify-content:center;
  flex-wrap:wrap;
  margin-bottom:15px;
}
input.newDebt {
  width:140px; 
  padding:10px; 
  border-radius:8px; 
  border:1px solid #333; 
  background:#222; 
  color:#0f0;
  font-size:14px;
}
input.newDebt:focus {
  outline:none;
  border-color:#4cff7a;
}
button {
  background:#1f1f1f; 
  color:#4cff7a; 
  border:1px solid #333; 
  padding:10px 20px; 
  border-radius:8px; 
  cursor:pointer; 
  font-weight:bold;
  transition:0.3s;
  font-size:14px;
}
button:hover {
  background:#2a2a2a;
  border-color:#4cff7a;
}
button:active {
  transform:scale(0.95);
}
.delete-btn {
  background:#ff5c5c;
  color:#fff;
  padding:4px 8px;
  margin-top:5px;
  font-size:11px;
  border-radius:4px;
  border:none;
}
.delete-btn:hover {
  background:#ff3030;
}
.status {
  text-align:center;
  padding:10px;
  border-radius:8px;
  margin:10px 0;
  font-size:13px;
  font-weight:bold;
}
.status.online {
  background:#1a3a1a;
  color:#4cff7a;
}
.status.offline {
  background:#3a1a1a;
  color:#ff5c5c;
}
</style>
</head>
<body>

<h1>üí∞ –ú—ñ–π —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏–π —à–ª—è—Ö</h1>

<div class="status" id="status">üîÑ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase...</div>

<div class="big" id="balance">-77200 ‚Ç¥</div>
<div class="small" id="phase">–§–∞–∑–∞: –∑–∞–∫—Ä–∏—Ç—Ç—è –±–æ—Ä–≥—ñ–≤</div>

<div class="progress">
  <div class="bar red" id="debtBar" style="width:0%">0%</div>
</div>

<div class="section">
  <h3>‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –±–æ—Ä–≥</h3>
  <div class="addForm">
    <input class="newDebt" id="newName" placeholder="–Ü–º'—è –±–æ—Ä–≥—É" autocomplete="off">
    <input class="newDebt" id="newValue" placeholder="–°—É–º–∞" type="number" min="0" step="100">
    <button onclick="addDebt()">‚úÖ –î–æ–¥–∞—Ç–∏</button>
  </div>
</div>

<div class="section">
  <h3>üîª –ë–æ—Ä–≥–∏ —Ç–∞ –≤–∏—Ç—Ä–∞—Ç–∏</h3>
  <div class="tilesContainer" id="debtsTiles">
    <div style="color:#666; width:100%; text-align:center; padding:20px;">
      ‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...
    </div>
  </div>
</div>

<script>
// ===== Firebase config =====
const firebaseConfig = {
  apiKey: "AIzaSyDLqI9hCXEVCVQnzWQAr_KsFdUOtxZGMDg",
  authDomain: "dolg-74757.firebaseapp.com",
  databaseURL: "https://dolg-74757-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "dolg-74757",
  storageBucket: "dolg-74757.firebasestorage.app",
  messagingSenderId: "838632651830",
  appId: "1:838632651830:web:b76cafc3e1c4b0e73a25e5"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== References =====
const debtsRef = db.ref("debts");
const connectedRef = db.ref(".info/connected");

// ===== DOM Elements =====
const debtsTiles = document.getElementById("debtsTiles");
const balanceDiv = document.getElementById("balance");
const phaseDiv = document.getElementById("phase");
const debtBar = document.getElementById("debtBar");
const statusDiv = document.getElementById("status");

// ===== Initial data - –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ =====
const initialDebts = [
  { name: "–î—ñ–º–∞", value: 44500, paid: 0 },
  { name: "–í–ª–∞–¥", value: 3000, paid: 0 },
  { name: "–ö–æ—Å—Ç—è", value: 2500, paid: 0 },
  { name: "–ê–ª—å–æ–Ω–∞", value: 2000, paid: 0 },
  { name: "–ú–∞–∫—Å–∏–º", value: 2000, paid: 0 },
  { name: "–ê–Ω–¥—Ä—ñ–π", value: 1000, paid: 0 },
  { name: "–ö—Ä–µ–¥–∏—Ç", value: 5000, paid: 0 },
  { name: "–û—á—ñ", value: 4000, paid: 0 },
  { name: "–ë–æ—Ç–æ–∫—Å", value: 5700, paid: 0 },
  { name: "–ì—É–±–∏", value: 5500, paid: 0 },
  { name: "–ú–µ–∑–æ—Ç–µ—Ä–∞–ø—ñ—è", value: 2000, paid: 0 }
];

// ===== Initialize data once =====
debtsRef.once("value").then(snap => {
  const existing = snap.val();
  if (!existing || Object.keys(existing).length === 0) {
    console.log("‚úÖ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö...");
    initialDebts.forEach(debt => {
      debtsRef.push({
        ...debt,
        created: Date.now()
      });
    });
  } else {
    console.log("‚úÖ –î–∞–Ω—ñ –≤–∂–µ —ñ—Å–Ω—É—é—Ç—å");
  }
});

// ===== Connection status =====
connectedRef.on("value", (snap) => {
  if (snap.val() === true) {
    statusDiv.className = "status online";
    statusDiv.textContent = "üü¢ –û–Ω–ª–∞–π–Ω - —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∞–∫—Ç–∏–≤–Ω–∞ –Ω–∞ –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö";
  } else {
    statusDiv.className = "status offline";
    statusDiv.textContent = "üî¥ –û—Ñ–ª–∞–π–Ω - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç";
  }
});

// ===== Render function =====
function render(debts) {
  if (debts.length === 0) {
    debtsTiles.innerHTML = '<div style="color:#666; width:100%; text-align:center; padding:20px;">–ù–µ–º–∞—î –±–æ—Ä–≥—ñ–≤. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π!</div>';
    balanceDiv.textContent = "0 ‚Ç¥";
    phaseDiv.textContent = "–î–æ–¥–∞–π—Ç–µ –±–æ—Ä–≥–∏ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è";
    debtBar.style.width = "0%";
    debtBar.textContent = "0%";
    return;
  }

  let debtSum = debts.reduce((s, d) => s + d.paid, 0);
  let totalDebt = debts.reduce((s, d) => s + d.value, 0);
  let balance = -totalDebt + debtSum;

  // Update balance
  balanceDiv.textContent = balance.toLocaleString('uk-UA') + " ‚Ç¥";
  balanceDiv.className = "big " + (balance < 0 ? "negative" : balance === 0 ? "" : "positive");
  
  // Update phase
  if (balance < 0) {
    phaseDiv.textContent = "–§–∞–∑–∞: –∑–∞–∫—Ä–∏—Ç—Ç—è –±–æ—Ä–≥—ñ–≤";
  } else if (balance === 0) {
    phaseDiv.textContent = "‚öñÔ∏è –§–∞–∑–∞: –Ω—É–ª—å–æ–≤–∏–π –±–∞–ª–∞–Ω—Å";
  } else {
    phaseDiv.textContent = "üìà –§–∞–∑–∞: –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É (—Ü—ñ–ª—å 45 000 ‚Ç¥)";
  }

  // Update progress bar
  const percent = totalDebt > 0 ? Math.round((debtSum / totalDebt * 100)) : 0;
  debtBar.style.width = percent + "%";
  debtBar.textContent = percent + "%";

  // Render debt tiles
  debtsTiles.innerHTML = "";
  debts.forEach((d, i) => {
    const remain = d.value - d.paid;
    const tilePercent = d.paid / d.value * 100;
    
    let color = "#181818";
    if (tilePercent === 100) color = "#4cff7a";
    else if (tilePercent > 0) color = "#ffcc00";
    else color = "#ff5c5c";

    const tile = document.createElement("div");
    tile.className = "tile";
    tile.style.background = color;
    
    tile.innerHTML = `
      <div class="tile-name">${d.name}</div>
      <input type="number" min="0" max="${d.value}" value="${d.paid}" 
             onchange="updateDebt('${d.id}', this.value)">
      <div class="tile-remain">–ó–∞–ª–∏—à–æ–∫: ${remain.toLocaleString('uk-UA')} ‚Ç¥</div>
      <button class="delete-btn" onclick="deleteDebt('${d.id}')">üóëÔ∏è</button>
    `;

    if (tilePercent === 100) {
      setTimeout(() => {
        tile.classList.add("jump");
        setTimeout(() => tile.classList.remove("jump"), 500);
      }, 50 * i);
    }

    debtsTiles.appendChild(tile);
  });
}

// ===== Firebase listeners - REALTIME SYNC =====
debtsRef.on("value", snap => {
  const debtsObj = snap.val() || {};
  const debts = Object.keys(debtsObj).map(k => ({ id: k, ...debtsObj[k] }));
  render(debts);
});

// ===== Functions =====
function updateDebt(id, val) {
  val = Number(val) || 0;
  debtsRef.child(id).update({ paid: val });
}

function addDebt() {
  const name = document.getElementById("newName").value.trim();
  const value = Number(document.getElementById("newValue").value);
  
  if (!name || !value) {
    alert("‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å —ñ–º'—è —Ç–∞ —Å—É–º—É –±–æ—Ä–≥—É!");
    return;
  }
  
  if (value <= 0) {
    alert("‚ö†Ô∏è –°—É–º–∞ –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ –Ω—É–ª—è!");
    return;
  }
  
  debtsRef.push({ 
    name: name, 
    value: value, 
    paid: 0,
    created: Date.now()
  });
  
  document.getElementById("newName").value = "";
  document.getElementById("newValue").value = "";
  document.getElementById("newName").focus();
}

function deleteDebt(id) {
  if (confirm("‚ùå –í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –±–æ—Ä–≥ –Ω–∞–∑–∞–≤–∂–¥–∏?")) {
    debtsRef.child(id).remove();
  }
}

// ===== Keyboard shortcuts =====
document.getElementById("newName").addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    document.getElementById("newValue").focus();
  }
});

document.getElementById("newValue").addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    addDebt();
  }
});

console.log("üöÄ –î–æ–¥–∞—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω–æ!");
console.log("üì± –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î –Ω–∞ –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö");
</script>
</body>

</html>
